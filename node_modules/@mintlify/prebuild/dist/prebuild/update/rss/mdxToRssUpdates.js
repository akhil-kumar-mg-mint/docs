import { getTags, isUpdate } from '@mintlify/common';
export const mdxToRssUpdates = (tree, existingUpdates) => {
    let updates = [];
    const updateComponents = tree.children.filter((child) => isUpdate(child));
    for (const updateComponent of updateComponents) {
        const attributes = updateComponent.attributes;
        const label = attributes.find((attribute) => attribute.type === 'mdxJsxAttribute' && attribute.name === 'label')?.value;
        const description = attributes.find((attribute) => attribute.type === 'mdxJsxAttribute' && attribute.name === 'description')?.value;
        const tags = getTags(updateComponent);
        const validTitle = label?.toString() || undefined;
        const validDescription = description?.toString() || '';
        const validTags = tags.length > 0 ? tags : undefined;
        const existingUpdate = existingUpdates.find((update) => update.title === validTitle);
        if (existingUpdate && existingUpdate.date) {
            updates.push(existingUpdate);
        }
        else if (validTitle) {
            updates.push({
                title: validTitle,
                date: new Date().toISOString(),
                description: validDescription,
                categories: validTags,
            });
        }
    }
    if (updates.length > 15) {
        updates = updates.slice(0, 15);
    }
    return updates;
};
